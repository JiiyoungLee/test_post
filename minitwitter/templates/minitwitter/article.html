<!DOCTYPE html>
<html>
<head>
<style>
	.hashtag_field {
		border: none;
		width: 100%;
	}
</style>
</head>
<body>
	<h1>Article Page</h1>
	<form method="POST" action="{{request.path}}" enctype="multipart/form-data">
	{% csrf_token %}
		{{ form1.as_p }}
		<script>
		var value = "";
		{% if form1.objects.tagged_set.all %} 
			{% for tagged in form1.objects.tagged_set.all %}
				value += "{{ tagged.hashtag.hashtag }}" 
			{% endfor %}
		{% endif %}
		</script>
		<input type="text" name="hashtag_field" class="hashtag_field" 
		 readonly></div>
		 <script>
		var value = "";
		{% if article.tagged_set.all %} 
			{% for tagged in article.tagged_set.all %}
				value += "{{ tagged.hashtag.hashtag }}  " 
			{% endfor %}
		{% endif %}
		document.getElementsByName("hashtag_field")[0].value = value;
		</script>
		 <br>
		{{ form3.label_tag }} {{ form3 }}
		{% if form2 %}
			{{ form2.as_p }}
		{% endif %}
		{% if article.photo_set.all %}
			{% for photo in article.photo_set.all %}
				<img src="/minitwitter/uploads/{{ photo.photo }}" width="150px" height="100px" id="img{{ photo.id }}">
				<input type="button" name="btn_delete_img" value="x" id="btn_delete_img{{ photo.id }}">
				<br>
			{% endfor %}
		{% endif %}
	<p>
	<input type="submit" value="write">
	</p>
	</form>
	<script>
	var btnDeleteImage = document.getElementsByName("btn_delete_img");
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			alert("Success to Delete Image.");
		}
	};
	for (let i = 0; i < btnDeleteImage.length; i++) {
		btnDeleteImage[i].addEventListener('click', function() {
			var btnId = btnDeleteImage[i].id.substr(14);
			var deleteImage = document.getElementById("img"+btnId);
			deleteImage.setAttribute("hidden", "");
			btnDeleteImage[i].setAttribute("hidden", "");
			xhttp.open("GET", "/minitwitter/delete/image/"+btnId, true);
			xhttp.send();
		});
	}

	var inputHashtag = document.getElementById("id_form3_prefix-hashtag");
	var divHashtagField = document.getElementsByName("hashtag_field")[0];
	inputHashtag.addEventListener('keyup', (event) => {
		if (event.keyCode=='32') {
			divHashtagField.value += "#"+inputHashtag.value+" ";
			inputHashtag.value = ""
		}
	});
</script>
</body>
</html>